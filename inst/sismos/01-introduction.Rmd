# <span style="color:blue">**Contenido de la Data**</span>

```{r setup, include = FALSE}
library(readr) # leer .csv
library(dplyr) # procesamiento de datos
library(skimr) # muestra variables categoricas y numericas
```

A continuación se presenta la base de datos a utilizar en la investigación. 


```{r}
sismo <- read_csv("C:/Users/victo/Documents/Maestría/1.2. Segundo semestre/Series de tiempo/data_sismo.csv")#Victoria
#sismo <- read_csv("/Users/wladimiravila/Desktop/Series_de_tiempo_MGM/data_sismo.csv")#wladimir
#sismo <- read_csv("D:/Documentos/GitHub/Series_de_tiempo/data_sismo.csv")#Mario
sismo <- mutate_if(sismo, is.character, tolower) # pasamos a minúsculas
glimpse(sismo)
```

## <span style="color:darkgreen">**Observación de los datos**</span>


### **El Tiempo Universal Coordinado (HORA_UTC):**
Es una escala de tiempo que es mantenida por los laboratorios de tiempo de todo el mundo y es determinada por relojes atómicos de alta precisión. El tiempo UTC es preciso a aproximadamente un nanosegundo (millonésima parte de un segundo) por día.

### **Magnitud Local (Ml):**
Donde A es la máxima amplitud de la traza registrada y Ao la amplitud máxima que sería producida por un sismo patrón, siendo éste aquel que produciría una deflexión de 0.001 mm en un sismógrafo ubicado a 100 km del epicentro.

### **Magnitud de momento (Mw):**
Esta magnitud es la más robusta; a diferencia de ML, mB y MS, la escala Mw no se satura, por lo que hoy en día es la más confiable y la más usada por las agencias dedicadas a la detección de sismos. También es la magnitud más usada por científicos para comparar los tamaños entre sismos.

### **Root Mean Square (RMS):**
Es la medida del error, comparando la diferencia promedio entre el tiempo de arribo teórico y el tiempo de arribo observado en segundos, utilizando las lecturas de los sismogramas.

### **Brecha sísmica (GAP):**

Zona geológica en la que no ha ocurrido un sismo fuerte durante un periodo prolongado de tiempo.


## <span style="color:darkgreen">**Descripción Datos** </span>

```{r}
skim(sismo)
```
La profundidad de sismos en kilómetros muestra una media de 145.0610908, con una desviación estándar de 5.16222274.Por su aprte, las magnitudes Ml y Mw, tienen medias de 1.8909980 y 3.4296736 respectivamente. La magnitud Mw muestra una tasa de completitud más baja, con un 5.97% de datos faltantes.

El número de fases registradas por evento tiene una media de 9.8856949, el RMS (Root Mean Square) y GAP (Brecha) presentan una media de 0.3912964 y 144.3370952 respectivamente.

## <span style="color:darkgreen">**Imputar Datos**</span>

* Existen **31826** datos faltantes **NA** para la variable **Magnitud Mw** por tanto se decide remover de la base de datos 
* Para las demás variables de tipo categórico, fecha, tiempo, y numérico no hay datos faltantes
* Las variables categóricas corresponden a la descripción del departamento de Santander, en su municipio de Los_Santos y para la columna estado se encuentran todos los datos en revisado, por tanto se procede a removerlas de la data original sismo
* Para el ejercicio académico se ha decidido remover las variables de error de latitud, longitud, y profundidad
* También se renombra las variables que contienen comillas en su estructura de columnas

```{r}
sismo_2 <- sismo
# las columnas retiradas fueron 7,8,9,13,14,15,16
sismo_2 <- sismo_2 [, c(1,2,3,4,5,6,10,11,12)] # data con 9 variables
colnames(sismo_2)[3] <-"LATITUD"  # renombrar variable
colnames(sismo_2)[4] <-"LONGITUD"  # renombrar variable
colnames(sismo_2)[5] <-"PROFUNDIDAD"  # renombrar variable
colnames(sismo_2)[6] <-"MAGNITUD_ML"  # renombrar variable
colnames(sismo_2)[7] <-"NUM_FASES"  # renombrar variable
colnames(sismo_2)[8] <-"RMS"  # renombrar variable
colnames(sismo_2)[9] <-"GAP"  # renombrar variable
head(sismo_2)
```

# <span style="color:blue">**Análisis Gráfico**</span>

Gráficas según el tipo de variable

```{r setup, include = FALSE}
library(ggpubr) # visualización
library(plotly) # visualización
library(CGPfunctions) # gráfica cuantitativas
library(ggplot2)
```



## <span style="color:darkgreen">**Variables Numéricas** </span>

```{r}
g1 = ggplot(sismo_2, aes(x = LATITUD)) + geom_histogram(fill="royalblue") + theme_gray()
g2 = ggplot(sismo_2, aes(x = LONGITUD)) + geom_histogram(fill="royalblue") + theme_gray()
g3 = ggplot(sismo_2, aes(x = PROFUNDIDAD)) + geom_histogram(fill="royalblue") + theme_gray()
g4 = ggplot(sismo_2, aes(x = MAGNITUD_ML)) + geom_histogram(fill="royalblue") + theme_gray()
g5 = ggplot(sismo_2, aes(x = NUM_FASES)) + geom_histogram(fill="royalblue") + theme_gray()
g6 = ggplot(sismo_2, aes(x = RMS)) + geom_histogram(fill="royalblue") + theme_gray()
g7 = ggplot(sismo_2, aes(x = GAP)) + geom_histogram(fill="royalblue") + theme_gray()


ggarrange(g1, g2, g3, g4, g5, g6, g7, labels = c("A", "B", "C","D", "E", "F","G"), ncol = 2, nrow = 2)
```

Los gráficos muestran la distribución de la latitud, longitud, profundidad, magnitud, número de fases,  Root Mean Square ( RMS) y la brecha sismica (GAP) de los sismos en el municipio de Los Santos, Santander. Cada gráfico representa la frecuencia de sismos en el eje y un dato específico relacionado con cada una de las variables en el eje x.
La profundidad presenta una media de 145 km, con relación a la magnitud es una forma asimetrica a la derecha con una media  de  1.8, el número de fases es una forma asimetrica a la izquierda y tiene una media de 9.8, por su parte el RMS y el GAP presentan una forma multimodal ya que aparecen varios picos y sus medias son de 0.3 y de 144 respectivamente. 


## <span style="color:darkgreen">**Variable Serie Tiempo** </span>

```{r setup, include = FALSE}
library(forecast) #predicción
library(tseries)  #análisis de series de tiempo
library(timsac)
library(changepoint) #detectar puntos de cambios

```

**Análisis de la Data**

A continuación se se seleccionan las variables de análisis para el presente ejercicio:

Profundidad: esta variable se selcciono dado que representa la profundidad del foco sísmico y este influye en cómo se siente un terremoto en la superficie, los terremotos superficiales, son aquellos que tienen un foco a menos de 70 km de profundidad, estos generalmente causan mas daño ya que la energía que liberan no se dispera tanto antes de llegar a la superficie. 

Magnitud: la magnitud en Colombia se reorta utilizando la escala de Richter, esta medida permite conocer cuanta es la energía liberada por un sismo.

```{r}
sismo_3 <- sismo_2 # copiamos data2
sismo_3 <- sismo_3 [, c(1,5,6)] # data con 3 variables 1:fecha, 5:profundidad, 6:magnitud
#sismo_3$fecha_hora <- paste(sismo_3$FECHA," ",sismo_3$HORA_UTC)# unir columnas 1 y 2
#sismo_3$fecha_hora <- as.POSIXct(sismo_3$fecha_hora) # convertir a tipo date time
#sismo_3$FECHA_UNIX <- as.POSIXct(sismo_3$FECHA)
sismo_3 <- sismo_3[order(sismo_3$FECHA), ] #ordenamo sismo_3 de menor a mayor
head(sismo_3,2)
```

Se agrupan las fechas para obtener un dato único por día, con relación a la magnitud se decidió calcular el maximo de cada día para conocer el sismo que libera la mayor cantidad de energía y con relación a la profundidad se decidió calcular el minimo con el fin de determianr el sismo que esta mas cerca a la superficie y puede causar mas daño.

```{r}
sismo_4_max <- sismo_3 %>% # Agrupamos por fecha y obtenemos el máximo de la magnitud para cada fecha
  group_by(FECHA) %>% 
  summarise(MAX_MAGNITUD_ML = max(MAGNITUD_ML),
            MIN_PROFUNDIDAD = min(PROFUNDIDAD))
head(sismo_4_max, 2)
```

Dado que no hay información para todos los días del año entre el 28 de febrero de 2011 y el 28 de febrero de 2018 primero se creo un data frame con todas las fechas en ese rango y posteriormente los datos faltantes en las variables MAGNITUD Y PROFUNCIDAD se llenaron de la siguiente forma:

Profundidad: la profundidad se decio llenar con la media que es 145.0610908. Esta decición esta fundamentada en que la revisar la gráfica de series de tiempo, si se llenaran con profundidad 0 generaria mucho ruido y no permitiria visualizar adecuadamente los simso que realmente presentan una profundida baja y cercana a la superficie.

Magnitud: la magnitud se decidio llenar con 0.

```{r}
# Crear un data frame con todas las fechas en el rango deseado
todas_las_fechas <- data.frame(FECHA = seq(as.Date("2011-02-28"), as.Date("2018-02-28"), by = "day"))

sismo_4_max_completo <- todas_las_fechas %>%
  left_join(sismo_4_max, by = "FECHA") %>%
  mutate(MAX_MAGNITUD_ML = ifelse(is.na(MAX_MAGNITUD_ML), 0, MAX_MAGNITUD_ML),
         MIN_PROFUNDIDAD = ifelse(is.na(MIN_PROFUNDIDAD), 145.0610908, MIN_PROFUNDIDAD))

head(sismo_4_max_completo, 2)

```

Se revisa que el número de filas concurde para comprobar que se encuentran todos los días entre el 28 de febrero de 2011 y el 28 de febrero de 2018.

```{r}
nrow(todas_las_fechas)
```

```{r}
nrow(sismo_4_max_completo)
```

**Serie de tiempo Magnitud**

```{r}
indice.ts <- ts(sismo_4_max_completo$MAX_MAGNITUD_ML,start = c(2011,2),end = c(2018,2), frequency = 365)
#head(indice.ts,10) 
head(indice.ts)
```

**Datos de la serie**

```{r}
"Tipo ts"
class(indice.ts)
"Inicio serie"
start(indice.ts)
"fin serie"
end(indice.ts)
```

**Gráfica de la serie**


```{r}
hist(indice.ts,main="",ylab="valor", col='orange', xlab ="MAGNITUD_ML")
title(main="SISMOS")
```
La distribución de la magnitud de los sismos en el municipio de Los Santos Santander evidencia que la mayoria de los sismos presentados son de magnitud baja y no presnetan un mayor riezgo para la población. Hay presencia de sismos de magnitud fuerte sin embargo hay que revisar la profundidad de estos para determinar si causan daños a la población.


```{r}
plot(indice.ts,main="",ylab="valor", col='orange', xlab ="FECHA")
title(main="SISMOS")
```

**Serie de tiempo Profundidad**

```{r}
P_indice.ts <- ts(sismo_4_max_completo$MIN_PROFUNDIDAD,start = c(2011,2),end = c(2018,2), frequency = 365)
#head(indice.ts,10) 
head(P_indice.ts)
```

**Datos de la serie**

```{r}
"Tipo ts"
class(P_indice.ts)
"Inicio serie"
start(P_indice.ts)
"fin serie"
end(P_indice.ts)
```

**Gráfica de la serie**

```{r}
hist(P_indice.ts,main="",ylab="valor", col='saddlebrown', xlab ="PROFUNDIDA")
title(main="SISMOS")
```
La distribución de la profundiad de los sismos en el municipio de Los Santos Santander evidencia que la mayoria de los sismos presentados son de alta profunidad y no presnetan un mayor riezgo para la población. 



```{r}
plot(P_indice.ts,main="",ylab="valor", col='saddlebrown', xlab ="FECHA")
title(main="SISMOS")
```




